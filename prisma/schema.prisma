generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
  engineType    = "binary"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ! ----- MODELS FOR USER ----- !

model User {
  id        String          @id @default(cuid())
  email     String          @unique
  fristName String
  lastName  String
  password  String
  token     sessionToken[]
  tickets   sessionTicket[]
  wallet    Wallet[]
}

model Wallet {
  id       String @id @default(cuid())
  userData User   @relation(fields: [email], references: [email])
  email    String @unique
  Amount   Int    @default(0)
}

model sessionToken {
  id       Int    @id @default(autoincrement())
  token    String @unique
  userData User   @relation(fields: [userId], references: [id])
  userId   String
}

// ! ----- MODELS FOR MOVIES ----- !
model MovieCinema {
  id       String  @unique @default(cuid())
  cinema   cinema @relation(fields: [cinemaID], references: [id])
  movie    Movies @relation(fields: [movieId], references: [id])
  movieId  Int
  cinemaID Int

  @@id([movieId, cinemaID]) 
}

model Movies {
  id         Int             @id @unique @default(autoincrement())
  movieName  String          @unique
  decription String
  time       String
  price      Int
  createdAt  String
  Tickets    sessionTicket[]
  cinemaData MovieCinema[]
  image       Images[]
}

model row {
  id            Int           @unique @default(autoincrement())
  row           Int
  selectedSeats String
  tickets       sessionTicket @relation(fields: [ticket], references: [ticket])
  ticket        Int
}

// ! ----- MODELS FOR TICKETS ----- !

model sessionTicket {
  ticket     Int      @unique
  userData   User     @relation(fields: [email], references: [email])
  email      String
  movieData  Movies   @relation(fields: [movieId], references: [id])
  movieId    Int
  useTicket  Boolean  @default(false)
  rows       row[]
  cinemaData cinema   @relation(fields: [cinemaID], references: [id])
  cinemaID   Int
  hallData   Hall     @relation(fields: [hallID], references: [id])
  hallID     Int
  dateEvent  date     @relation(fields: [date], references: [date])
  date       DateTime
  Time       String
  price      Int
}

// ! ----- MODELS FOR CINEMA ----- !

model cinema {
  id         Int             @unique @default(autoincrement())
  cinemaName String
  address    String
  city       String
  province   String
  halls      Hall[]
  movies     MovieCinema[] 
  tickets    sessionTicket[]
  dates      date[]
  image       Images[]
}

model Hall {
  id          Int             @unique @default(autoincrement())
  hallName    String
  maximumRows Int
  cinemaData  cinema          @relation(fields: [cinemaID], references: [id])
  cinemaID    Int
  tickets     sessionTicket[]
}

model date {
  id         Int             @id @default(autoincrement())
  date       DateTime        @unique
  cinemaData cinema          @relation(fields: [cinemaID], references: [id])
  cinemaID   Int
  tickets    sessionTicket[]
}


// ! ----- MODELS FOR IMAGES ----- !

model Images {
  id        String  @id @default(cuid())
  name      String  @unique
  url       String
  createdAt DateTime? @default(now())
  movieData Movies? @relation(fields: [movieId], references: [id])
  movieId   Int?
  cinemaData cinema? @relation(fields: [cinemaID], references: [id])
  cinemaID  Int?
}
